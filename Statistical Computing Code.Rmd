
Code Provided During Labs for 6370 Statistical Computing

```{r examine dataframe}

pacman::p_load(dplyr                          # summarize()
               )

# read data
load(url("https://www.stat.osu.edu/~vqv/6730/data/fev.RData"))

# check structure of dataframe; lists types
str(fevdata)

# break another variable into groups; add as column
fevdata <- mutate(fevdata, age_group = cut(age, breaks = 5))

# calculate mean for each age
fev_mean <- summarize(group_by(fevdata, age), fev = mean(fev))


```

```{r scatter ggplot basics}
# some of these commands draw on variables created in data examine chunk

# data source (loaded and manipulated in examine chunk)
# load(url("https://www.stat.osu.edu/~vqv/6730/data/fev.RData"))

# download necessary packages
pacman::p_load(ggplot2)                         # ggplot()

# create ggplot; aesthetic map variables
s <- ggplot(fevdata, aes(x = age, y = fev))
s + geom_point()                                # add points for each datum

# demonstrate geom_jitter
s <- ggplot(fevdata, aes(x = age, y = fev))
s + geom_jitter() 

# add color mapping by smoke variable
s <- ggplot(fevdata, aes(x = age, y = fev, color=smoke))
s + geom_point()

# add color mapping by age variable - those 13+
s <- ggplot(fevdata, aes(x = age, y = fev, color=age < 13))
s + geom_point()

# add group mapping by smoke variable
p <- ggplot(fevdata, aes(x = age, y = fev, group = smoke))
p + geom_point() + stat_smooth(aes(color = smoke))  # map color for only smooth component

# specify border color and fill
ggplot(fevdata, aes(x = age, y = fev)) +
  geom_point(color = "black",                   # needs to be defined in geom_point()
             fill = "white", 
             shape = 21, 
             size = 4, 
             stroke = 1)

# plot mean across each age
s <- ggplot(fevdata, aes(x = age, y = fev))     # basic ggplot
s + geom_point() + geom_line(data = fev_mean)   # add line across averages

# option to fix coordinate plane with 1:1 aspect ratio (supposedly)
s + geom_point() + coord_fixed()
```

```{r facet_grid}
# some of these commands may draw on variables created in data examine chunk

# data source (loaded and manipulated in examine chunk)
# load(url("https://www.stat.osu.edu/~vqv/6730/data/fev.RData"))

# download necessary packages
pacman::p_load(dplyr,                           
               ggplot2)                             # ggplot()

# grid with specified rows and columns
p <- ggplot(fevdata, aes(x = height, y = fev)) + 
  facet_grid(rows = vars(sex), cols = vars(age_group))
p + geom_point(aes(color = smoke))

# grid with specified rows only
p <- ggplot(fevdata, aes(x = height, y = fev)) + 
  facet_grid(rows = vars(sex))
p + geom_point(aes(color = smoke))
```


```{r boxplot ggplot basics}
# some of these commands may draw on variables created in data examine chunk

# data source (loaded and manipulated in examine chunk)
# load(url("https://www.stat.osu.edu/~vqv/6730/data/fev.RData"))

# download necessary packages
pacman::p_load(dplyr,                           
               ggplot2)                             # ggplot()

# create boxplot by age
p <- ggplot(fevdata, aes(x = age, y = fev))
p + geom_boxplot(mapping = aes(x = as.factor(age))) # consider age categorical
p + geom_boxplot(mapping = aes(x = as.factor(age_group))) # consider age group

# split and color by smoker status
p + geom_boxplot(mapping = aes(x = as.factor(age_group), fill = smoke))

# option for horizontal box plots
ggplot(fevdata) + 
  geom_boxplot(mapping = aes(x = sex, y = fev)) +
  coord_flip()
```

```{r geom_bar/col plots}
# some of these commands may draw on variables created in data examine chunk

# data source (loaded and manipulated in examine chunk)
# load(url("https://www.stat.osu.edu/~vqv/6730/data/fev.RData"))

# download necessary packages
pacman::p_load(dplyr,                           
               ggplot2)                             # ggplot()

# geom_bar plot requires group = 1 to consider as a whole rather than by cut
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, group = 1))
```

```{r pie chart}

# download necessary packages
pacman::p_load(dplyr,                           
               ggplot2)                             # ggplot()

# pie chart of diamond cut
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(y = 1, fill = cut)) +
  coord_polar()

# equivalent pie chart
ggplot(data = diamonds) +
  geom_bar(mapping = aes(x = 1, fill = cut)) +
  coord_polar(theta = "y")
```


```{r manual smoothing}

# data source (loaded and manipulated in examine chunk)
# load(url("https://www.stat.osu.edu/~vqv/6730/data/fev.RData"))

# use linear regression
linear_model <- lm(fev ~ age, data=fevdata)              # fit linear model
target_values <- data.frame(
  age = seq(from = min(fevdata$age), 
            to = max(fevdata$age), 
            length.out = 100)
)                                                        # create x values
predictions <- mutate(target_values, 
                      fev = predict(linear_model, 
                                    newdata = target_values)
                      )                                  # find y_hats
p <- ggplot(data = fevdata, mapping = aes(x = age, y = fev))
p + 
  geom_point() +                                         # scatter plot
  geom_line(data = predictions, color = "red")           # linear overlay

# locally-weighted smoothers
polynomial_model <- loess(fev ~ age,
                          data = fevdata,
                          degree = 2,                     # ??
                          span = .75)                     # window to consider
predictions <- mutate(target_values,
                      fev = predict(polynomial_model,     # new predictions
                                    newdata = target_values)
                      )
p +
  geom_point() +
  geom_line(data = predictions, color = "red")

# map color to line with legend
p +
  geom_point() + 
  geom_line(data = predictions, mapping = aes(color = "Original Line")) + 
  geom_line(data = 2+predictions, mapping = aes(color = "Demonstrate"))

```

```{r geom_smooth()}

# data source (loaded and manipulated in examine chunk)
# load(url("https://www.stat.osu.edu/~vqv/6730/data/fev.RData"))

# basic plot
p <- ggplot(data = fevdata, mapping = aes(x = age, y = fev))

# show geom_smooth
p + 
  geom_point() + 
  geom_smooth()

# linear geom_smooth
p + 
  geom_point() + 
  geom_smooth(method = lm)

# IMPORTANT
# Confidence Intervals generated by GGPlot are NOT valid if the model is not true
# turn off confidence bounds
p + 
  geom_point() + 
  geom_smooth(se = FALSE)

# polynomial geom_smooth
p + 
  geom_point() + 
  geom_smooth(method = loess,
              method.args = list(degree = 2, span = .75))

# specify desired model
p + 
  geom_point() + 
  geom_smooth(method = lm,
              formula = y~x+I(x^2), se = FALSE)
p + 
  geom_point() + 
  geom_smooth(method = lm, formula = y~poly(x, degree = 3), se = FALSE)

# view by smoker status
p + 
  geom_point(aes(color = smoke)) +                     # map point color to smoke
  geom_smooth(aes(color = smoke)) +                    # map lines to smoke
  facet_grid(rows = vars(smoke))                       # separate plots

```

